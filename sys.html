<html>
<head>
    <title>PLSA.R : Secure Systems</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <link rel="stylesheet"
          href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/default.min.css">
    <link rel="stylesheet"
          href="benefit/css/syntax.css">
    <script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script>

    <meta name="keywords" content="java, java server, server, java web system, web framework, inversion of control, dependency injection"/>

    <link href="benefit/plsar.icon.png" rel="icon" type="image/png" />
    <link rel="stylesheet" href="benefit/css/default.css">
    <script src="benefit/bsshh.js"></script>
</head>
<body>

<div class="peoo square"></div>

<a href="index.html" class="logo-wrapper">

    <svg class="identity" version="1.2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 90 99" width="90" height="99">
        <style>
            .s0 { fill: transparent;stroke: #00faff;stroke-linejoin: round; }
        </style>
        <path class="s0" d="m79.4 93.4l-44-21.9 41-27.2z"/>
        <path class="s0" d="m29.4 33.4l-27.4-13.7 25.5-16.9z"/>
    </svg>

    <h1 class="logo">PLSA.R</h1>
</a>

<div class="content">

    <ul class="navigation">
        <li><a href="asp.html">aspects</a></li>
        <li><a href="sys.html" class="active">secure_systems</a></li>
        <li><a href="repo.html">persistent_systems</a></li>
        <li><a href="index.html">index</a></li>
    </ul>
    <br class="clear"/>

    <h1>SECURE<br/>SYSTEM.S</h1>

    <p>Systems often times require authentication and authorization in order to
        keep the system safe and secure. PLSA.R is packaged with
        a security layer built in. </p>

    <p>Configuring PLSA.R for authentication and authorization.</p>

    <pre><code>public class Main {

    public static void main(String[] args){

        PLSAR plsar = new PLSAR(9001);

        ViewConfig viewConfig = new ViewConfig();
        viewConfig.setViewsPath("");//defaults to webapp located in src/main/
        viewConfig.setResourcesPath("resources");
        viewConfig.setViewExtension(".jsp");
        plsar.setViewConfig(viewConfig);

        plsar.addViewRenderer(AuthenticatedRenderer.class);
        plsar.addViewRenderer(GuestRenderer.class);
        plsar.addViewRenderer(UserRenderer.class);

        plsar.setSecurityAccess(AuthSecurityAccess.class);

        // performance & persistence configurations

        plsar.start();
    }
}</code></pre>

    <p>There are two important sections to pay attention to.
        The one below tells PLSA.R what class to use in order to check if authenticated,
        if user has permission, role and to retrieve the logged in user id.</p>

    <pre><code>plsar.setSecurityAccess(AuthSecurityAccess.class);</code></pre>

    <h3>AuthSecurityAccess.java</h3>

    <pre><code>package io.foo;

import net.plsar.Dao;
import net.plsar.security.SecurityAccess;
import io.foo.model.Permission;
import io.foo.model.User;

import java.util.ArrayList;
import java.util.HashSet;
import java.util.List;
import java.util.Set;

public class AuthSecurityAccess implements SecurityAccess {

    Dao dao;

    @Override
    public void setDao(Dao dao) {
        this.dao = dao;
    }

    @Override
    public String getPassword(String credential){
        User user = getUser(credential);
        return user.getPassword();
    }

    @Override
    public Set&lt;String&gt; getRoles(String credential){
        User user = getUser(credential);
        String sql = "select permission from user_roles where user_id = [+]";
        List&lt;UserRole&gt; rolesList = (ArrayList) dao.getList(sql, new Object[]{ user.getId() }, UserRole.class);
        Set&lt;String&gt; roles = new HashSet<>();
        for(UserRole role: rolesList){
            roles.add(role.getName());
        }
        return roles;
    }

    @Override
    public Set&lt;String&gt; getPermissions(String credential){
        User user = getUser(credential);
        String sql = "select permission from user_permissions where user_id = [+]";
        List&lt;Permission&gt; permissionsList = (ArrayList) dao.getList(sql, new Object[]{ user.getId() }, Permission.class);
        Set&lt;String&gt; permissions = new HashSet<>();
        for(Permission permission: permissionsList){
            permissions.add(permission.getPermission());
        }
        return permissions;
    }

    public User getUser(String credential){
        String phonesql = "select * from users where phone = '[+]'";
        User user = (User) dao.get(phonesql, new Object[] { credential }, User.class);
        if(user == null){
            String emailsql = "select * from users where email = '[+]'";
            user = (User) dao.get(emailsql, new Object[] { credential }, User.class);
        }
        return user;
    }

}</code></pre>


    <p>What you see above is a contract implementation or an interface implementation that is required
    by PLSA.R in order to leverage the authentication and authorization piece.</p>

    <p>There will be times when you need to check if the user has a specific role or permission see below:</p>

    <pre><code>if(!securityManager.hasRole("SUPER_USER", req)){
    cache.set("message", "permission required.");
    return "redirect:/users/identity/" + id;
}</code></pre>

    <pre><code>if(!securityManager.hasPermission(permission, req)){
    cache.set("message", "permission required.");
    return "redirect:/users/identity/" + id;
}</code></pre>

    <p>The final piece, view renderers. ViewRenderers are view snippets that allow the
        developer to either render some html on render or determine via a boolean check
        whether to display html code. Below are 3 security view renderers that ship with
        PLSA.R.</p>

    <pre><code>plsar.addViewRenderer(AuthenticatedRenderer.class);
plsar.addViewRenderer(GuestRenderer.class);
plsar.addViewRenderer(UserRenderer.class);</code></pre>

    <p><code>AuthenticatedRenderer.class</code> allows for this code aspect to
        be inserted into your view.</p>

    <pre><code>&lt;plsar:authenticated&gt;
//-> html
&lt;/plsar:authenticated&gt;</code></pre>

    <p><code>GuestRenderer.class</code> checks to see if the current user is a guest, if so,
        renders the code snippet between. Corresponding view code snippet.</p>

    <pre><code>&lt;plsar:guest&gt;
//-> html
&lt;/plsar:guest&gt;</code></pre>

    <p><code>UserRenderer.class</code> renders the current username.
        Corresponding view code snippet.</p>

    <pre><code>&lt;plsar:user&gt;
//-> html
&lt;/plsar:user&gt;</code></pre>

    <p style="text-align:center;"><a href="https://ae0n.net" style="border: none; " class="pls">
        <span style="margin:0px auto;text-align: center;display:inline-block;font-size:9px;">&copy;2023 Mike Croteau</span>

    </a></p>

    <p style="text-align:center;"><a href="https://ae0n.net" style="border: none; " class="pls">
        <span style="margin:0px auto;text-align: center;display:inline-block;font-size:9px;"><img src="ae0n-lght.png" style="width:70px;"/></span>

    </a></p>

    <p style="text-align:center;"><a href="https://www.jetbrains.com/" style="border: none; " class="pls">
        <span style="margin:0px auto;text-align: center;display:inline-block;font-size:9px;">Developed with <img src="ij-logo.png" style="width:23px;"/></span>

    </a></p>
    <div class="break"></div>

</div>


<script>
    let elements = document.getElementsByClassName('peoo')
    for(z = 0; z < elements.length; z++){
        let element = elements[z]
        var x = new RandomObjectMover(element, window);
        x.setSpeed(parseInt(140));
        x.start();
    }
</script>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-D9G7SYVHH7"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-D9G7SYVHH7');
</script>

</body>
</html>

