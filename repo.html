<html>
<head>
    <title>PLSA.R : Open Source Java Server + Framework</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <link rel="stylesheet"
          href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/default.min.css">
    <link rel="stylesheet"
          href="benefit/css/syntax.css">
    <script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script>

    <meta name="keywords" content="java, java server, server, java web system, web framework, inversion of control, dependency injection"/>

    <link href="benefit/plsar.icon.png" rel="icon" type="image/png" />
    <link rel="stylesheet" href="benefit/css/default.css">
    <script src="benefit/bsshh.js"></script>
</head>
<body>

<div class="peoo square"></div>

<div class="logo-wrapper">

    <svg class="identity" version="1.2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 90 99" width="90" height="99">
        <style>
            .s0 { fill: transparent;stroke: #00faff;stroke-linejoin: round; }
        </style>
        <path class="s0" d="m79.4 93.4l-44-21.9 41-27.2z"/>
        <path class="s0" d="m29.4 33.4l-27.4-13.7 25.5-16.9z"/>
    </svg>

    <h1 class="logo">PLSA.R</h1>
</div>

<div class="content">

    <ul class="navigation">
        <li><a href="sys.html">secure_systems</a></li>
        <li><a href="repo.html" class="active">persistent_systems</a></li>
        <li><a href="index.html">index</a></li>
    </ul>
    <br class="clear"/>

    <h1>PERSISTENT<br/>SYSTEM.S</h1>

    <p>Almost 100% of the time, your system will require a database to store,
        search and retrieve information. PLSA.R comes with a builtin persistence layer
        with dependency injection, this boosts capacity potentially allowing the application
        to handle hundreds of thousands concurrent requests.</p>

    <p>The setup allowing for persistence.</p>

    <h3>Main.java</h3>


    <pre><code>
public class Main {
    public static void main(String[] args){
        PLSA.R plsar = new PLSA.R(9001);
        plsar.setNumberOfPartitions(32);
        plsar.setNumberOfRequestExecutors(70);

        PersistenceConfig persistenceConfig = new PersistenceConfig();
        persistenceConfig.setDriver(Drivers.H2);
        persistenceConfig.setUrl("jdbc:h2:~/PLSAR_DB");
        persistenceConfig.setUser("sa");
        persistenceConfig.setPassword("");

        SchemaConfig schemaConfig = new SchemaConfig();
        schemaConfig.setSchema("schema.sql");
        schemaConfig.setEnvironment(Environments.DEVELOPMENT);

        plsar.setPersistenceConfig(persistenceConfig);
        plsar.setSchemaConfig(schemaConfig);
        plsar.setPageRenderingScheme(RenderingScheme.RELOAD_EACH_REQUEST);

        plsar.start();
    }
}</code></pre>


    <p>Let's go through the setup. A persistent instance of PLSAR requires a PersistenceConfig
    object like below. The settings are standard:</p>


    <pre><code>PersistenceConfig persistenceConfig = new PersistenceConfig();
persistenceConfig.setDriver(Drivers.H2);
persistenceConfig.setUrl("jdbc:h2:~/PLSAR_DB");
persistenceConfig.setUser("sa");
persistenceConfig.setPassword("");</code></pre>

    <p>The PersistenceConfig object above is configured to use PLSA.R's built in H2 database.
    The layer also requires a SchemaConfig object.</p>

    <pre><code>SchemaConfig schemaConfig = new SchemaConfig();
schemaConfig.setSchema("schema.sql");
schemaConfig.setEnvironment(Environments.DEVELOPMENT);</code></pre>

    <p>This tells PLSA.R to look in <code>src/main/resources/</code> for a
    <code>schema.sql</code> file with the sql necessary to create all of the
    tables and load any development data. <code>Environments.DEVELOPMENT</code>
    set on the environments method tells PLSA.R to run this script on startup everytime.</p>

    <pre><code>SchemaConfig schemaConfig = new SchemaConfig();
schemaConfig.setEnvironment(Environments.PRODUCTION);</code></pre>

    <p>This makes PLSA.R data ready, meaning all tables have been created, no script needs to be ran
        on startup.</p>

    <p>A sample a repo class. This Repo will perform all of the necessary crud operations, save, read,
        update, delete. We will inject this class into a user controller.</p>


    <pre><code>import io.foo.model.*;
import net.plsar.Dao;
import net.plsar.annotations.Repository;

import java.util.ArrayList;
import java.util.List;

@Repository
public class UserRepo {

    Dao dao;

    public UserRepo(Dao dao) {
        this.dao = dao;
    }

    public long getId() {
        String sql = "select max(id) from users";
        long id = dao.getLong(sql, new Object[]{});
        return id;
    }

    public User get(long id) {
        String sql = "select * from users where id = [+]";
        User user = (User) dao.get(sql, new Object[] { id }, User.class);
        return user;
    }

    public List&lt;User&gt; getList() {
        String sql = "select * from users";
        List&lt;User&gt; users = (ArrayList) dao.getList(sql, new Object[]{}, User.class);
        return users;
    }

    public boolean save(User user) {
        String sql = "insert into users (name, phone, password) values ('[+]','[+]',[+])";
        dao.save(sql, new Object[]{
                user.getName(),
                user.getPhone(),
                user.getPassword()
        });
        return true;
    }

    public boolean update(User user) {
        String sql = "update users set name = '[+]', phone = '[+]', password = '[+]' where id = [+]";
        dao.update(sql, new Object[]{
                user.getName(),
                user.getPhone(),
                user.getPassword(),
                user.getId()
        });
        return true;
    }

    public boolean delete(long id) {
        String sql = "delete from users where id = [+]";
        dao.update(sql, new Object[] { id });
        return true;
    }

}</code></pre>

    <p>Our repo class is aptly annotated with <code>@Repository</code>,
        this tells PLSA.R to add the class to the list of future available dependencies.
        If defining a repo you must declare a single parameter constructor which inherits a
        <code>net.plsar.Dao</code> object. You must also define a <code>Dao</code> field setting the Dao
        field to the constructor <code>Dao</code>. Binding via dependency injection is a little more flimsy,
        this makes the application.</p>


    <pre><code>@Controller
public class UserController {

    @Bind
    UserRepo userRepo;

    @Design("/designs/default.jsp")
    @Get("/users/{id}")
    public String getUser(PageCache cache, NetworkRequest req, @Component Long id) throws ParseException {
        User user = userRepo.get(id);
        if(user == null){
            cache.set("message", "user cannot be found with id: " + id);
            return "redirect:/";
        }

        cache.set("user", user);

        return "/pages/render.jsp";
    }

}</code>
    </pre>

    <p>We have created a request controller that renders a user.
        We left it simple to get you started. Controllers must be annotated with
        <code>@Controller</code> annotation in order for PLSA.R to register it within
        the request negotiators. Repos can be injected with the <code>@Bind</code> annotation.
        The name of the dependency needs to match 100% to the repo.</p>


    <p class="pls">&copy;2023 Mike Croteau</p>

    <div class="break"></div>

</div>






<script>
    let elements = document.getElementsByClassName('peoo')
    for(z = 0; z < elements.length; z++){
        let element = elements[z]
        var x = new RandomObjectMover(element, window);
        x.setSpeed(parseInt(140));
        x.start();
    }
</script>
</body>
</html>

